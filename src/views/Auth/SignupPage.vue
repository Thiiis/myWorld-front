<template>
  <div class="min-vh-100 d-flex align-items-center justify-content-center p-4" 
       style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%);">
    
    <!-- ë°°ê²½ ì¥ì‹ -->
      <!-- ë°°ê²½ ì¥ì‹ -->
    <div class="position-fixed top-0 start-0 w-100 h-100 overflow-hidden" style="pointer-events: none;">
      <div class="position-absolute text-primary opacity-25" style="top: 40px; left: 40px;">
        <i class="bi bi-cloud" style="font-size: 3rem;"></i>
      </div>
      <div class="position-absolute text-info opacity-25" style="top: 128px; right: 64px;">
        <i class="bi bi-water" style="font-size: 2.2rem;"></i>
      </div>
      <div class="position-absolute text-primary opacity-25" style="bottom: 96px; left: 64px;">
        <i class="bi bi-cloud" style="font-size: 2.5rem;"></i>
      </div>
    </div>

    <div class="w-100 position-relative" style="max-width: 500px; z-index: 10;">
      <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
      <button
        @click="$emit('back-to-landing')"
        class="btn btn-outline-primary mb-4 d-flex align-items-center gap-2 px-4 py-2 pixel-font">
        <i class="bi bi-arrow-left"></i>
        ëŒì•„ê°€ê¸°
      </button>
        <!-- ìƒë‹¨ í—¤ë” -->
      <div class="text-center mb-4">
        <div class="d-flex align-items-center justify-content-center gap-3 mb-4">
          <div class="d-flex align-items-center justify-content-center rounded-3 shadow-lg" 
               style="width: 48px; height: 48px; background: linear-gradient(135deg, var(--maintheme), var(--river-blue));">
            <i class="bi bi-star-fill text-white"></i>
          </div>
          <h1 class="display-6 pixel-font text-primary mb-0" style="letter-spacing: 1.5px;">
            ë§ˆì´ì›”ë“œ
          </h1>
        </div>
        <p class="small english-pixel text-muted" style="letter-spacing: 0.5px;">
          â˜ï¸ JOIN OUR SKY WORLD â˜ï¸
        </p>
      </div>
  <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
    <div class="card-body p-4" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);">

      <div class="text-center mb-4">
        <h2 class="h4 pixel-font text-primary d-flex align-items-center justify-content-center gap-2"
          style="letter-spacing: 1px;">
          <i class="bi bi-person-plus"></i>
          íšŒì›ê°€ì…
          <i class="bi bi-person-plus"></i>
        </h2>
        <hr class="border-primary opacity-25 my-3">
      </div>
      <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
      <div v-if="error" class="alert alert-danger alert-dismissible fade show pixel-font" role="alert">
        {{ error }}
        <button type="button" class="btn-close" @click="error = ''" aria-label="Close"></button>
      </div>
      <form @submit.prevent="handleSignup" class="mx-auto" style="max-width: 400px;">
        <div class="mb-3">
          <label for class="form-label pixel-font fw-bold text-dark">â˜ï¸ ì•„ì´ë”” (ID)</label>
          <input type="text" class="form-control" v-model="signupForm.account" placeholder="ì˜ë¬¸, ìˆ«ì ì¡°í•© (4-20ì)" />
        </div>
        <div class="mb-3">
          <label for class="form-label pixel-font fw-bold text-dark">â˜ï¸ ë¹„ë°€ë²ˆí˜¸ (PASSWORD)</label>
          <input type="password" class="form-control" v-model="signupForm.pwd" placeholder="ì˜ë¬¸, ìˆ«ì ì¡°í•© (6ì ì´ìƒ)" />
        </div>
        <div class="mb-3">
          <label for class="form-label pixel-font fw-bold text-dark">â˜ï¸ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" class="form-control" v-model="signupForm.pwdConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" />
        </div>
        <div class="mb-3">
          <label for class="form-label pixel-font fw-bold text-dark">â˜ï¸ ë‹‰ë„¤ì„ (NICKNAME)</label>
          <input type="text" class="form-control" v-model="signupForm.nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" />
        </div>
        <div class="mb-3">
          <label for class="form-label pixel-font fw-bold text-dark">â˜ï¸ ì´ë©”ì¼ (EMAIL)</label>
          <input type="email" class="form-control" v-model="signupForm.email" placeholder="example@email.com" />
        </div>
        <div class="mb-3">
          <label for class="form-label pixel-font fw-bold text-dark">â˜ï¸ ìƒë…„ì›”ì¼ (BIRTHDATE)</label>
          <input type="text" class="form-control" v-model="signupForm.birthdate" placeholder="1998-12-26" />
        </div>
        <button type="submit" class="btn btn-primary w-100"
          style="font-size: 1rem; letter-spacing: 1px; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);">â˜ï¸ íšŒì›ê°€ì… ì™„ë£Œ
          â˜ï¸</button>
        <button type="button" class="btn btn-white w-100 mt-2" @click="$router.push('/login')"
          style="font-size: 1rem; letter-spacing: 1px; border-width: 2px; background-color: rgba(59, 130, 246, 0.1);">
          ğŸ’™ ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”? ë¡œê·¸ì¸ ğŸ’™
        </button>
      </form>
      <div class="mt-4 text-center">
        <p class="small english-pixel text-muted" style="letter-spacing: 0.5px;">
          â˜ï¸ CREATE YOUR SKY WORLD â˜ï¸
        </p>
      </div>
    </div>
    </div>
    </div>
    </div>
</template>

<script setup>
import memberApi from '@/apis/memberApi'; // API ëª¨ë“ˆ ì„í¬íŠ¸
import { ref } from 'vue';
import { useRouter } from 'vue-router';

// Router ì–»ê¸°
const router = useRouter();

// ìƒíƒœ ì •ì˜ (ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸ì™€ ê°™ì´ ref ì‚¬ìš©)
const signupForm = ref({
  account: '',
  pwd: '',
  pwdConfirm: '', // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•„ë“œ ì¶”ê°€
  nickname: '',
  email: '',
  birthdate: '',
});

// ì´ë²¤íŠ¸ ì²˜ë¦¬ í•¨ìˆ˜ (ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸ì˜ async/await êµ¬ì¡°ì™€ ë™ì¼í•˜ê²Œ)
async function handleSignup() {
  // í”„ë¡ íŠ¸ì—”ë“œ ìœ íš¨ì„± ê²€ì‚¬ (ì˜ˆ: ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜)
  if (signupForm.value.pwd.trim() !== signupForm.value.pwdConfirm.trim()) {
    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    return;
  }

  try {
    // APIì— ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„ (structuredCloneìœ¼ë¡œ ê¹Šì€ ë³µì‚¬)
    // pwdConfirm í•„ë“œëŠ” ì„œë²„ì— ë³´ë‚¼ í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ ì œì™¸í•©ë‹ˆë‹¤.
    const { ...dataToSend } = structuredClone(signupForm.value);

    // memberApië¥¼ ì‚¬ìš©í•˜ì—¬ íšŒì›ê°€ì… ìš”ì²­
    const response = await memberApi.memberSignup(dataToSend);

    // ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µ(ìƒíƒœ ì½”ë“œ 200)ì„ ë°›ì•˜ì„ ê²½ìš°
    if (response.status === 200) {
      alert('íšŒì›ê°€ì…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
      await router.push('/login'); // íšŒì›ê°€ì… ì„±ê³µ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    } else {
      // 200 ì™¸ì˜ ë‹¤ë¥¸ ìƒíƒœ ì½”ë“œë¥¼ ë°›ì•˜ì„ ê²½ìš°ì˜ ì²˜ë¦¬ (í•„ìš” ì‹œ)
      console.log(response.data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µì…ë‹ˆë‹¤.');
      alert(response.data.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  } catch (error) {
    // ìš”ì²­ ì‹¤íŒ¨ ì‹œ (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ì„œë²„ ì—ëŸ¬ ë“±)
    console.error(error);
    // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    alert(error.response?.data?.message || 'íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
}
</script>

<style scoped>
.pixel-font,
* {
  font-family: 'DungGeunMo', sans-serif !important;
}

.english-pixel {
  font-family: 'Upheaval', sans-serif !important;
}

.btn:hover {
  transform: scale(1.05);
}

.form-control:focus {
  border-color: var(--maintheme);
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
  transform: scale(1.02);
}

.alert {
  border-radius: 12px;
}

.card {
  backdrop-filter: blur(10px);
}
</style>